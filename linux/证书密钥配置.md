#### 密钥管理

##### 生成密钥对

```shell
# 推荐使用 Ed25519 算法（现代、安全、高效）
ssh-keygen -t ed25519 -C "usage annotation" -f ./gitea-actions

# 使用 RSA 算法（兼容性更好） 至少 2048 位 推荐 4096 位
ssh-keygen -t rsa -b 4096 -C "usage annotation" -f ./gitea-actions

# 设置私钥仅当前用户可读写
chmod 600 ~/.ssh/your_private_key
# 公钥可读即可
chmod 644 ~/.ssh/your_private_key.pub
# .ssh 目录权限
chmod 700 ~/.ssh
```

##### 设置 SSH 免密登录

```shell
# 将公钥复制到服务器的 ~/.ssh/authorized_keys 文件中
```



#### 自签名证书

##### 生成证书

```ini
# cert.conf
[req]
default_bits       = 2048
prompt             = no
default_md         = sha256
req_extensions     = req_ext
x509_extensions    = req_ext
distinguished_name = dn

[dn]
C  = CN
ST = Guangdong
L  = Shenzhen
O  = zhu
OU = aliyun
CN = 47.115.33.186

[req_ext]
subjectAltName = @alt_names

[alt_names]
IP.1 = 47.115.33.186
```

```shell
# 生成自签名证书
openssl req -x509 -nodes -days 365 \
  -newkey rsa:2048 \
  -keyout xxx.key \
  -out xxx.crt \
  -config cert.conf

# 查看生成的证书
openssl x509 -in xxx.crt -noout -text
```

##### 将证书添加至受信任证书列表

```shell
# 添加
cp gitea.crt /usr/local/share/ca-certificates/gitea.crt
update-ca-certificates

# 删除
rm /usr/local/share/ca-certificates/gitea.crt
update-ca-certificates
```

